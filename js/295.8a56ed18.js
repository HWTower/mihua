"use strict";(self["webpackChunkmihua"]=self["webpackChunkmihua"]||[]).push([[295],{2295:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%",height:"55em"}},[t("div",{staticStyle:{width:"98%",height:"100%","background-color":"white","margin-top":"2%"}},[t("div",[t("div",{staticStyle:{width:"96%",height:"5em","margin-top":"2%"}},[t("div",{staticStyle:{float:"left","margin-left":"2%"}},[t("el-select",{staticStyle:{position:"relative",top:"1.2em",left:"-15%",border:"1px solid rgb(233, 233, 233)",width:"30%"},attrs:{placeholder:"请选择"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-input",{staticStyle:{position:"relative",top:"1.2em",border:"1px solid rgb(233, 233, 233)",width:"50%"},attrs:{placeholder:"请输入内容","suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),t("el-button",{staticStyle:{position:"relative",top:"1.2em",right:"-18em"},attrs:{type:"primary"},on:{click:function(t){return e.openAddDialog()}}},[e._v("添加系统角色")]),t("el-dialog",{attrs:{visible:e.dialogVisible,title:"添加企业",width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"addForm",attrs:{model:e.newBusiness,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"企业名称",prop:"rolename"}},[t("el-input",{staticStyle:{width:"100%",border:"1px solid rgb(233, 233, 233)"},model:{value:e.newBusiness.rolename,callback:function(t){e.$set(e.newBusiness,"rolename",t)},expression:"newBusiness.rolename"}})],1),t("el-form-item",{attrs:{label:"描述",prop:"describe"}},[t("el-input",{staticStyle:{width:"100%",border:"1px solid rgb(233, 233, 233)"},model:{value:e.newBusiness.describe,callback:function(t){e.$set(e.newBusiness,"describe",t)},expression:"newBusiness.describe"}})],1),t("el-form-item",{attrs:{label:"权限"}},[t("el-tree",{ref:"tree",staticStyle:{width:"100%",height:"8em",border:"1px solid rgb(233, 233, 233)","overflow-y":"scroll"},attrs:{data:e.data,"show-checkbox":"","default-expanded-keys":[0],"node-key":"id","highlight-current":"",props:e.defaultProps}})],1),t("el-form-item",{attrs:{label:"状态",prop:"status"}},[t("el-radio-group",{model:{value:e.newBusiness.status,callback:function(t){e.$set(e.newBusiness,"status",t)},expression:"newBusiness.status"}},[t("el-radio",{attrs:{label:1}},[e._v("启用")]),t("el-radio",{attrs:{label:0}},[e._v("禁用")])],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.addRoles}},[e._v("确认")])],1)],1),t("el-dialog",{attrs:{visible:e.editDialogVisible,title:"编辑企业",width:"40%"},on:{"update:visible":function(t){e.editDialogVisible=t}}},[t("el-form",{ref:"editForm",attrs:{model:e.editBusiness,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"企业名称",prop:"rolename"}},[t("el-input",{staticStyle:{width:"100%",border:"1px solid rgb(233, 233, 233)"},model:{value:e.editBusiness.rolename,callback:function(t){e.$set(e.editBusiness,"rolename",t)},expression:"editBusiness.rolename"}})],1),t("el-form-item",{attrs:{label:"描述",prop:"describe"}},[t("el-input",{staticStyle:{width:"100%",border:"1px solid rgb(233, 233, 233)"},model:{value:e.editBusiness.describe,callback:function(t){e.$set(e.editBusiness,"describe",t)},expression:"editBusiness.describe"}})],1),t("el-form-item",{attrs:{label:"权限"}},[t("el-tree",{ref:"tree",staticStyle:{width:"100%",height:"8em",border:"1px solid rgb(233, 233, 233)","overflow-y":"scroll"},attrs:{data:e.data,"show-checkbox":"","node-key":"id","default-expanded-keys":[0],"highlight-current":"",props:e.defaultProps}})],1),t("el-form-item",{attrs:{label:"状态",prop:"status"}},[t("el-radio-group",{model:{value:e.editBusiness.status,callback:function(t){e.$set(e.editBusiness,"status",t)},expression:"editBusiness.status"}},[t("el-radio",{attrs:{label:1}},[e._v("启用")]),t("el-radio",{attrs:{label:0}},[e._v("禁用")])],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveEdit}},[e._v("保存")])],1)],1)],1)]),t("div",{staticStyle:{width:"96%",height:"90%","background-color":"white"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{prop:"rolename",label:"角色名称"}}),t("el-table-column",{attrs:{prop:"describe",label:"角色描述"}}),t("el-table-column",{attrs:{prop:"powers",label:"角色权限配置"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis","font-size":"14px"}},[e._v(e._s(e.getNameByIdList(s.row.powers)))])]}}])}),t("el-table-column",{attrs:{prop:"status",label:"角色启用状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(1===t.row.status?"启用":"禁用")+" ")]}}])}),t("el-table-column",{attrs:{prop:"lasttime",label:"最后编辑时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDate(t.row.lasttime))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(t){return e.openEditDialog(s.row)}}}),t("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.delOpen(1,s.row)}}}),t("el-button",{attrs:{type:"text",icon:"el-icon-switch-button"},on:{click:function(t){return e.stopRoles(s.row)}}})]}}])})],1),t("div",{staticStyle:{width:"100%",height:"10%",display:"flex","align-items":"center","justify-content":"center"}},[t("div",{staticStyle:{display:"flex","margin-left":"3%","margin-right":"3%",width:"38%","align-items":"center","justify-content":"center"}},[t("p",{staticStyle:{width:"35%","margin-left":"1%","margin-right":"3%"}},[e._v(" 已选中的行数："+e._s(e.selectedCount)+" ")]),t("el-button",{staticStyle:{"margin-left":"1%"},attrs:{type:"danger"},on:{click:function(t){return e.delOpen(2)}}},[e._v("批量删除")]),t("el-button",{staticStyle:{"margin-left":"1%"},attrs:{type:"danger"},on:{click:function(t){return e.stopAllRoles()}}},[e._v("批量启用/停用")])],1),t("div",{staticClass:"block"},[t("el-pagination",{attrs:{"page-sizes":[10,20,30,40,50],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])],1)])])},l=[],a=s(8008),o={data(){return{options:[{value:"选项1",label:"cr-01"},{value:"选项2",label:"cr-02"}],value:"",tableData:[],obj:{page:1,pagelimit:10},total:0,selectedCount:0,selection:[],dialogVisible:!1,newBusiness:{rolename:"",describe:"",powers:[],status:null},rules:{rolename:[{required:!0,message:"请输入企业名称",trigger:"blur"}],describe:[{required:!0,message:"请输入描述",trigger:"blur"}]},editDialogVisible:!1,editBusiness:{rolename:"",describe:"",powers:[],status:null},search:"",data:[{id:0,label:"开放所有权限",children:[{id:1,label:"首页"},{id:2,label:"企业管理"},{id:3,label:"通话统计",children:[{id:4,label:"并发统计"}]},{id:5,label:"权限管理",children:[{id:6,label:"系统角色管理"},{id:7,label:"系统用户管理"}]}]}],defaultProps:{children:"children",label:"label"},arr_data:[]}},mounted(){this.value=this.options[0].value,this.getRoleslist(),this.getMenu()},watch:{search(){this.getSearchroles()}},methods:{getCheckedKeys(){return this.$refs.tree.getCheckedKeys()},setCheckedKeys(){this.$refs.tree.setCheckedKeys(this.editBusiness.powers)},getMenu(){(0,a.yy)().then((e=>{this.arr_data=e.data.data}))},getNameByIdList(e){const t=e.split(",").map(Number),s=t.map((e=>{const t=this.arr_data.find((t=>t.id===e));return t?t.name:null}));return s.filter((e=>null!==e)).join(", ")},handleSizeChange(e){this.obj.pagelimit=e,this.getRoleslist()},handleCurrentChange(e){this.obj.page=e,this.getRoleslist()},getRoleslist(){(0,a.Wm)(this.obj).then((e=>{this.tableData=e.data.data,this.total=e.data.pagecount}))},handleSelectionChange(e){this.selectedCount=e.length,this.selection=e},openAddDialog(){this.dialogVisible=!this.dialogVisible},addRoles(){this.newBusiness.powers=this.$refs.tree.getCheckedKeys().join(","),(0,a.vZ)(this.newBusiness).then((e=>{"系统角色添加成功"==e.msg?(this.$message({type:"success",message:"添加成功!"}),this.openAddDialog()):this.$message({message:e.msg,type:"warning"}),this.getRoleslist()}))},openEditDialog(e){this.editBusiness={...e},this.editBusiness.powers=e.powers.split(",").map(Number),this.editDialogVisible=!0,this.$nextTick((()=>{this.$refs.tree&&this.setCheckedKeys()}))},saveEdit(){this.editBusiness.powers=this.$refs.tree.getCheckedKeys().join(","),(0,a.vH)(this.editBusiness).then((e=>{"修改成功"==e.msg?(this.$message({type:"success",message:"修改成功!"}),this.editDialogVisible=!1):this.$message({message:e.msg,type:"warning"}),this.getRoleslist()}))},delOpen(e,t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{1==e?this.delRoles(t):2==e&&this.delAllRoles(),this.$message({type:"success",message:"删除成功!"})})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},delRoles(e){const t={id:e.id};(0,a.Hi)(t).then((()=>{this.getRoleslist()}))},delAllRoles(){for(var e=0;e<this.selection.length;e++)this.delRoles(this.selection[e])},getSearchroles(){const e={rolename:this.search};(0,a.kr)(e).then((e=>{console.log(e),this.tableData=e.data.data}))},stopRoles(e){const t={id:e.id,status:!e.status};(0,a.gw)(t).then((()=>{this.getRoleslist()}))},stopAllRoles(){for(var e=0;e<this.selection.length;e++)this.stopRoles(this.selection[e])},formatDate(e){const t=1e3*e,s=new Date(t),i=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");return`${i}-${l}-${a}`}}},r=o,n=s(1656),d=(0,n.A)(r,i,l,!1,null,null,null),c=d.exports}}]);
//# sourceMappingURL=295.8a56ed18.js.map